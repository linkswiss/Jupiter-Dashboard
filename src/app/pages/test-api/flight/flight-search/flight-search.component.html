<nb-accordion [nbSpinner]="loading" nbSpinnerStatus="primary" class="mb-2">
    <nb-accordion-item #accordionItemRq expanded="true">
        <nb-accordion-item-header class="font-weight-bold">Flight Avail Rq
            <jupiter-api-response-status *ngIf="jupiterFlightAvailabilityRs" [status]="jupiterFlightAvailabilityRs.Status"></jupiter-api-response-status>
        </nb-accordion-item-header>
        <nb-accordion-item-body>

            <form *ngIf="jupiterFlightAvailabilityRq.Request">
                <!-- MAIN INPUT -->
                <div>
                    <div class="row">
                        <div class="form-group col-sm-4">
                            <label for="adultCount" class="label">Adult Count</label>
                            <nb-select fullWidth id="adultCount" placeholder="Adult Count" [outline]="true" [(selected)]="jupiterFlightAvailabilityRq.Request.AdultCount">
                                <nb-option [value]="1">1</nb-option>
                                <nb-option [value]="2">2</nb-option>
                                <nb-option [value]="3">3</nb-option>
                                <nb-option [value]="4">4</nb-option>
                            </nb-select>
                        </div>
                        <div class="form-group col-sm-4">
                            <label for="childCount" class="label">Child Count</label>
                            <nb-select fullWidth id="childCount" placeholder="Child Count" [outline]="true" [(selected)]="jupiterFlightAvailabilityRq.Request.ChildCount">
                                <nb-option [value]="-1">-1</nb-option>
                                <nb-option [value]="0">0</nb-option>
                                <nb-option [value]="1">1</nb-option>
                                <nb-option [value]="2">2</nb-option>
                                <nb-option [value]="3">3</nb-option>
                                <nb-option [value]="4">4</nb-option>
                            </nb-select>
                        </div>
                        <div class="form-group col-sm-4">
                            <label for="infantCount" class="label">Infant Count</label>
                            <nb-select fullWidth id="infantCount" placeholder="Infant Count" [outline]="true" [(selected)]="jupiterFlightAvailabilityRq.Request.InfantCount">
                                <nb-option [value]="0">0</nb-option>
                                <nb-option [value]="1">1</nb-option>
                                <nb-option [value]="2">2</nb-option>
                                <nb-option [value]="3">3</nb-option>
                                <nb-option [value]="4">4</nb-option>
                            </nb-select>
                        </div>
                    </div>
                    <div class="row">

                        <div class="form-group col-sm-4">
                            <label for="connectors" class="label">Search Connectors</label>
                            <nb-select #selectConnectors fullWidth id="connectors" placeholder="Search Connectors" [multiple]="true" [outline]="true" (selectedChange)="searchConnectorsChanged($event);selectConnectors.hide();" [(selected)]="jupiterFlightAvailabilityRq.Request.ConnectorsSearch">
                                <nb-option *ngFor="let connector of connectors" [value]="connector">{{connector}}</nb-option>
                            </nb-select>
                            <jupiter-connectors-environment [(ConnectorsEnvironment)]="jupiterFlightAvailabilityRq.ConnectorsEnvironment"></jupiter-connectors-environment>
                        </div>

                        <div class="form-group col-sm-4">
                            <label for="debugConnectors" class="label">Debug Connectors</label>
                            <nb-select #selectDebugConnectors fullWidth id="debugConnectors" placeholder="Debug Connectors" [multiple]="true" [outline]="true" (selectedChange)="selectDebugConnectors.hide();" [(selected)]="jupiterFlightAvailabilityRq.Request.ConnectorsDebug">
                                <nb-option *ngFor="let connector of connectors" [value]="connector">{{connector}}</nb-option>
                            </nb-select>
                        </div>

                        <div class="form-group col-sm-4">
                            <div>
                                <nb-checkbox fullWidth name="MergeConnectorResults" [(ngModel)]="jupiterFlightAvailabilityRq.Request.MergeConnectorResults">Merge Connector Results</nb-checkbox>
                            </div>
                            <div>
                                <nb-checkbox fullWidth name="ForceNotCachedResponse" [(ngModel)]="jupiterFlightAvailabilityRq.ForceNotCachedResponse">Force NotCached Response</nb-checkbox>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- END MAIN INPUT -->

                <!-- INPUT CUSTOM DATA -->
                <div *ngIf="jupiterFlightAvailabilityRq.Request.ConnectorCustomData && jupiterFlightAvailabilityRq.Request.ConnectorCustomData.length > 0">
                    <nb-accordion class="shadow-none border-box">
                        <nb-accordion-item *ngFor="let connectorSettings of jupiterFlightAvailabilityRq.Request.ConnectorCustomData; let customDataIndex = index;">
                            <nb-accordion-item-header>
                                <span class="badge badge-pill badge-primary">{{connectorSettings['_discriminator']}}</span><span class="ml-1">Custom Data</span>
                                <div class="ml-1">
                                    <button nbButton size="tiny" status="danger" (click)="deleteCustomData(customDataIndex)" ngbTooltip="Delete Custom Data" placement="top" container="body"><i class="fas fa-trash"></i></button>
                                </div>
                            </nb-accordion-item-header>
                            <nb-accordion-item-body>
                                <jupiter-custom-data-inputs [(CustomData)]="jupiterFlightAvailabilityRq.Request.ConnectorCustomData[customDataIndex]"></jupiter-custom-data-inputs>
                            </nb-accordion-item-body>
                        </nb-accordion-item>
                    </nb-accordion>
                </div>
                <!-- END INPUT CUSTOM DATA -->

                <!-- STEP LIST -->
                <h6>Flight Steps <button nbButton size="tiny" (click)="addStep()" ngbTooltip="Add a Step" placement="top" container="body"><i class="fas fa-plus"></i></button></h6>
                <div *ngIf="jupiterFlightAvailabilityRq.Request.FlightSteps">
                    <div *ngFor="let step of jupiterFlightAvailabilityRq.Request.FlightSteps; let stepIndex = index;" class="border-box">
                        <div class="float-right">
                            <button *ngIf="stepIndex > 0" nbButton size="tiny" status="danger" (click)="deleteStep(stepIndex)" ngbTooltip="Delete this Room" placement="top" container="body"><i class="fas fa-trash"></i></button>
                        </div>

                        <!-- STEP REQUEST -->
                        <div>
                            <div class="row">
                                <div class="form-group col-sm-3">
                                    <!--                <div>Date: <b>{{step.DepartureDate | amDateFormat:'DD/MM/YYYY'}}</b></div>-->
                                    <label class="label">Departure Date</label>
                                    <input nbInput id="DepartureDate{{stepIndex+1}}" name="DepartureDate{{stepIndex+1}}" fullWidth [nbDatepicker]="depDate" [(ngModel)]="step['_DepartureDateMoment']">
                                    <nb-datepicker #depDate format="DD/MM/YYYY" (dateChange)="handleDateChange($event, step)"></nb-datepicker>
                                </div>
                                <div class="form-group col-sm-3">
                                    <label for="DepartureApt{{stepIndex+1}}" class="label">Departure Airport</label>
                                    <input nbInput fullWidth id="DepartureApt{{stepIndex+1}}" name="DepartureApt{{stepIndex+1}}" placeholder="Departure IATA" class="iata-input" (ngModelChange)="setDepartureAirport($event, step)" [ngModel]="step.DepartureAirport">
                                </div>
                                <div class="form-group col-sm-3">
                                    <label for="ArrivalApt{{stepIndex+1}}" class="label">Arrival Airport</label>
                                    <input nbInput fullWidth id="ArrivalApt{{stepIndex+1}}" name="ArrivalApt{{stepIndex+1}}" placeholder="Arrival IATA" class="iata-input" (ngModelChange)="setArrivalAirport($event, step)" [ngModel]="step.ArrivalAirport">
                                </div>
                                <div class="form-group col-sm-3">
                                    <label for="Cabin{{stepIndex+1}}" class="label">Cabin</label>
                                    <nb-select fullWidth id="Cabin{{stepIndex+1}}" placeholder="Cabin" [outline]="true" [(selected)]="step.Cabin">
                                        <nb-option *ngFor="let cabin of EFlightCabinList" [value]="cabin">{{cabin}}</nb-option>
                                    </nb-select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-3">
                                    <nb-checkbox fullWidth name="OnlyDirectFlights{{stepIndex+1}}" [(ngModel)]="step.OnlyDirectFlights">Only Directs</nb-checkbox>
                                    <nb-checkbox fullWidth name="BaggageIncluded{{stepIndex+1}}" [(ngModel)]="step.BaggageIncluded">Baggage</nb-checkbox>
                                    <nb-checkbox fullWidth name="EnableJumpCabin{{stepIndex+1}}" [(ngModel)]="step.EnableJumpCabin">Jump Cabin</nb-checkbox>
                                </div>
                                <div class="col-sm-3">
                                    <label for="DepartureTime{{stepIndex+1}}" class="label">Departure Time (hh:mm)</label>
                                    <input nbInput fullWidth id="DepartureTime{{stepIndex+1}}" name="DepartureTime{{stepIndex+1}}" placeholder="Departure Time" class="iata-input" [(ngModel)]="step.DepartureTime">
                                    <label for="DepartureTimeWindow{{stepIndex+1}}" class="label">Departure TimeWindow (Number)</label>
                                    <input nbInput fullWidth id="DepartureTimeWindow{{stepIndex+1}}" name="DepartureTimeWindow{{stepIndex+1}}" placeholder="Departure TimeWindow" class="iata-input" [(ngModel)]="step.DepartureTimeWindow">
                                </div>
                                <div class="col-sm-3">
                                    <label for="ExcludedCarriers{{stepIndex+1}}" class="label">Excluded Carriers</label>
                                    <tag-input fullWidth id="ExcludedCarriers{{stepIndex+1}}" name="ExcludedCarriers{{stepIndex+1}}" placeholder="ExcludedCarriers" (onAdd)="utils.addTagInputValue($event, step.ExcludedCarriers)" [(ngModel)]="step.ExcludedCarriers"></tag-input>
                                </div>
                                <div class="col-sm-3">
                                    <label for="IncludedCarriers{{stepIndex+1}}" class="label">Included Carriers</label>
                                    <tag-input fullWidth id="IncludedCarriers{{stepIndex+1}}" name="IncludedCarriers{{stepIndex+1}}" placeholder="IncludedCarriers" (onAdd)="utils.addTagInputValue($event, step.IncludedCarriers)" [(ngModel)]="step.IncludedCarriers"></tag-input>
                                </div>
                            </div>
                        </div>

                        <!-- STEP CUSTOM DATA -->
                        <div>

                            <hr>
                            <div>Step Custom Data</div>
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <label for="step{{stepIndex}}ConnectorCode" class="label">Connector Custom Data</label>
                                    <nb-select fullWidth id="step{{stepIndex}}ConnectorCode" placeholder="Connectors" [multiple]="true" [outline]="true" (selectedChange)="stepConnectorCustomDataConnectorCodeChanged($event, step)" [(selected)]="step['_ConnectorCustomDataConnectors']">
                                        <nb-option *ngFor="let connector of connectors" [value]="connector">{{connector}}</nb-option>
                                    </nb-select>
                                </div>
                            </div>

                            <!-- CUSTOM DATA LIST -->
                            <div *ngIf="step.ConnectorCustomData && step.ConnectorCustomData.length > 0">
                                <nb-accordion class="shadow-none border-box">
                                    <nb-accordion-item *ngFor="let connectorSettings of step.ConnectorCustomData; let stepCustomDataIndex = index;">
                                        <nb-accordion-item-header>
                                            <span class="badge badge-pill badge-primary">{{connectorSettings['_discriminator']}}</span><span class="ml-1">Custom Data</span>
                                            <div class="ml-1">
                                                <button nbButton size="tiny" status="danger" (click)="deleteStepCustomData(stepCustomDataIndex, step)" ngbTooltip="Delete Custom Data" placement="top" container="body"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </nb-accordion-item-header>
                                        <nb-accordion-item-body>
                                            <jupiter-custom-data-inputs [(CustomData)]="step.ConnectorCustomData[stepCustomDataIndex]"></jupiter-custom-data-inputs>
                                        </nb-accordion-item-body>
                                    </nb-accordion-item>
                                </nb-accordion>
                            </div>
                            <!-- END CUSTOM DATA LIST -->

                        </div>
                        <!-- END STEP CUSTOM DATA -->

                    </div>
                </div>
                <!-- END STEP LIST -->

            </form>

            <!-- SEARCH BTN -->
            <div class="row">
                <div class="col-sm-12 text-center">
                    <button class="btn btn-sm btn-primary" (click)="searchFlights()"><i class="fas fa-exchange-alt"></i> Search</button>
                </div>
            </div>

        </nb-accordion-item-body>
    </nb-accordion-item>
</nb-accordion>

<!-- FLIGHT AVAIL MESSAGES/DEBUG -->
<jupiter-api-messages-accordion Title="Flight Avail" [ApiRs]="jupiterFlightAvailabilityRs"></jupiter-api-messages-accordion>
<jupiter-api-debug-accordion Title="Flight Avail" [(ApiRq)]="jupiterFlightAvailabilityRq" [ApiRs]="jupiterFlightAvailabilityRs"></jupiter-api-debug-accordion>
<!-- END FLIGHT AVAIL MESSAGES/DEBUG -->

<!-- FLIGHT DETAILS MESSAGES/DEBUG -->
<div *ngIf="jupiterFlightDetailRq">
    <jupiter-api-messages-accordion Title="Flight Detail" [ApiRs]="jupiterFlightDetailRs"></jupiter-api-messages-accordion>
    <jupiter-api-debug-accordion Title="Flight Detail" [(ApiRq)]="jupiterFlightDetailRq" [ApiRs]="jupiterFlightDetailRs"></jupiter-api-debug-accordion>
</div>
<!-- END FLIGHT DETAILS MESSAGES/DEBUG -->

<!-- FLIGHT DETAILS RESPONSE -->
<div *ngIf="jupiterFlightDetailRs && jupiterFlightDetailRs.Response && jupiterFlightDetailRs.Response.Pnr">
    <jupiter-flight-pnr-display [currentPnr]="jupiterFlightDetailRs.Response.Pnr"></jupiter-flight-pnr-display>
</div>
<!-- END FLIGHT DETAILS RESPONSE -->

<!-- FLIGHT AVAIL RESPONSE -->
<div *ngIf="jupiterFlightAvailabilityRs && jupiterFlightAvailabilityRs.Response && jupiterFlightAvailabilityRs.Response.FlightResults">

    <virtual-scroll [items]="jupiterFlightAvailabilityRs.Response.FlightResults" (update)="viewPortItems = $event" style="height: 700px">
        <nb-card *ngFor="let result of viewPortItems; let resIndex = index;" class="mb-2">
            <nb-card-body class="m-0 p-0 pt-1 pb-1">
                <div class="container" *ngFor="let fare of result.FareList; let fareIndex = index;">
                    <div *ngIf="fareIndex > 0">
                        <hr style="border-top: 3px solid rgba(0, 0, 0, 0.1);"> </div>
                    <div class="row align-items-center">
                        <div class="col-sm-8 pr-0">
                            <div *ngFor="let segment of result.FlightSegments; let segIndex = index;" class="container p-0">
                                <div *ngIf="segIndex > 0 && segment.StepGroupId !== result.FlightSegments[segIndex-1].StepGroupId" class="border-bottom border-primary mt-3 mb-3"></div>
                                <div *ngIf="segIndex > 0 && segment.StepGroupId === result.FlightSegments[segIndex-1].StepGroupId" class="row align-items-center">
                                    <div class="col-sm-5"></div>
                                    <div class="col-sm-4 text-center">-- Connection: {{segment.ConnectionTime.substr(0,5)}} --</div>
                                </div>
                                <div class="row align-items-center">
                                    <div class="col-sm-3">
                                        <!--<h1>{{segment.StepGroupId}}</h1>-->
                                        <span class="pr-2"><img [src]="segment.MarketingCarrier.IataCode | carrierImage" width="32px"/></span>
                                        <span class="font-weight-bold cursor-pointer" ngbTooltip="{{segment.MarketingCarrier.Name}}" placement="top" container="body">{{segment.MarketingCarrier.IataCode}}&nbsp;{{segment.MarketingCarrier.FlightNumber}}</span>
                                        <span *ngIf="segment.MarketingCarrier.IataCode !== segment.OperatingCarrier.IataCode" class="badge badge-warning text-white p-2 m-1 cursor-pointer" ngbTooltip="Operating Carrier: {{segment.OperatingCarrier.Name}}" placement="top" container="body">{{segment.OperatingCarrier.IataCode}}</span>
                                    </div>
                                    <div class="col-sm-2">
                                        <span class="font-weight-bold cursor-pointer" ngbTooltip="{{segment.DepartureAirport.Name}} ({{segment.DepartureAirport.CityName}})" placement="top" container="body">{{segment.DepartureAirport.IataCode}}</span>
                                        <span class="font-weight-bold ml-1 mr-1">--</span>
                                        <span class="font-weight-bold cursor-pointer" ngbTooltip="{{segment.ArrivalAirport.Name}} ({{segment.ArrivalAirport.CityName}})" placement="top" container="body">{{segment.ArrivalAirport.IataCode}}</span>
                                    </div>
                                    <!--<div class="col-sm-2">-->
                                    <div class="col-sm-4 text-center">
                                        <span class="font-weight-bold pr-2">{{segment.DepartureDate | amDateFormat:'HH:mm'}}</span>
                                        <span class="font-italic font-size-small">{{segment.DepartureDate | amDateFormat:'DD/MM'}}</span>
                                        <!--</div>-->
                                        <!--<div class="col-sm-2">-->
                                        <span class="font-weight-bold pr-2 pl-5">{{segment.ArrivalDate | amDateFormat:'HH:mm'}}</span>
                                        <span class="font-italic font-size-small">{{segment.ArrivalDate | amDateFormat:'DD/MM'}}</span>
                                    </div>

                                    <div class="col-sm-3">

                                        <div *ngFor="let paxFare of fare.PaxFareList" class="row mb-1">
                                            <span *ngIf="fare.PaxFareList && fare.PaxFareList.length > 1" class="badge bg-hint text-white p-2 m-1">{{paxFare.PaxCount}} {{paxFare.PaxType}}</span>

                                            <span *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]" class="cursor-pointer">
                        <span [ngSwitch]="paxFare.FlightSegmentDetails[segIndex].FareType" ngbTooltip="Fare Type: {{paxFare.FlightSegmentDetails[segIndex].FareType}}" placement="right" container="body">
                          <span *ngSwitchCase="'PUBLIC'" class="badge bg-hint text-white p-2 m-1">PU</span>
                                            <span *ngSwitchCase="'PRIVATE'" class="badge badge-info text-white p-2 m-1">PR</span>
                                            <span *ngSwitchCase="'TO'" class="badge badge-primary text-white p-2 m-1">TO</span>
                                            <span *ngSwitchDefault class="badge badge-warning text-white p-2 m-1">?</span>
                                            </span>
                                            </span>

                                            <span *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]" class="cursor-pointer">
                        <span [ngSwitch]="paxFare.FlightSegmentDetails[segIndex].Cabin" ngbTooltip="Cabin: {{paxFare.FlightSegmentDetails[segIndex].Cabin}}" placement="right" container="body">
                          <span *ngSwitchCase="'ECONOMY'" class="badge badge-secondary text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchCase="'PREMIUM_ECONOMY'" class="badge badge-secondary text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchCase="'BUSINESS'" class="badge badge-info text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchCase="'PREMIUM_BUSINESS'" class="badge badge-info text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchCase="'FIRST'" class="badge badge-success text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchCase="'PREMIUM_FIRST'" class="badge badge-success text-white p-2 m-1">{{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span>
                                            <span *ngSwitchDefault class="badge badge-warning text-white p-2 m-1">?</span>
                                            </span>
                                            </span>

                                            <span *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]" class="pt-1 pl-1 cursor-pointer" ngbTooltip="Baggage: {{paxFare.FlightSegmentDetails[segIndex]?.BaggageDetails?.BaggageCount}} pieces" placement="right" container="body">
                        <span *ngIf="paxFare.FlightSegmentDetails[segIndex] && paxFare.FlightSegmentDetails[segIndex].BaggageDetails && paxFare.FlightSegmentDetails[segIndex].BaggageDetails.BaggageCount > 0">
                          <i class="fas fa-camera fa-suitcase-rolling info-icon text-primary"></i>
                        </span>
                                            <span *ngIf="!paxFare.FlightSegmentDetails[segIndex] || !paxFare.FlightSegmentDetails[segIndex].BaggageDetails || paxFare.FlightSegmentDetails[segIndex].BaggageDetails.BaggageCount === 0">
                          <i class="fas fa-camera fa-suitcase-rolling info-icon text-black-50"></i>
                        </span>
                                            </span>

                                            <span class="pt-1 pl-1 cursor-pointer" [ngbPopover]="fareTemplate" placement="right" container="body" popoverTitle="Fare Infos" triggers="mouseenter:mouseleave">
                        <i class="fas fa-info-circle info-icon text-black-50"></i>
                      </span>

                                            <span *ngIf="paxFare.Refundable === false" class="pt-1 pl-1 cursor-pointer" ngbTooltip="Not Refundable" placement="right" container="body"> <i class="fas fa-exclamation-triangle text-warning info-icon"></i></span>

                                            <ng-template #fareTemplate>
                                                <div>Pax Fare: <span class="badge badge-pill badge-primary">{{paxFare.PaxCount}} {{paxFare.PaxType}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">BrandedFare: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].BrandedFare}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">FareType: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].FareType}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">FareType Code: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].FareTypeCode}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">MatchedAccountCode: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].MatchedAccountCode}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">FareBasis: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].FareBasis}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">Cabin: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].Cabin}} - {{paxFare.FlightSegmentDetails[segIndex].CabinCode}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">Class Avail: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].ClassAvail}} {{paxFare.FlightSegmentDetails[segIndex].Class}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">Bag: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex]?.BaggageDetails?.BaggageCount}}</span></div>
                                                <div *ngIf="paxFare.FlightSegmentDetails && paxFare.FlightSegmentDetails[segIndex]">Meal: <span class="badge badge-pill badge-primary">{{paxFare.FlightSegmentDetails[segIndex].Meal?.Code}} {{paxFare.FlightSegmentDetails[segIndex].Meal?.Text}}</span></div>
                                            </ng-template>

                                            <span class="pt-1 pl-1 cursor-pointer" [ngbPopover]="fareDebug" placement="right" container="body" popoverTitle="Pax Fare Debug" triggers="click:click">
                        <i class="fas fa-bug text-black-50"></i>
                      </span>

                                            <ng-template #fareDebug>
                                                <pre>Fare Json: {{paxFare | json }}</pre>
                                            </ng-template>

                                        </div>
                                    </div>
                                </div>
                                <!--<div *ngIf="result.FlightSegments.length > 1 && segIndex < result.FlightSegments.length -1 && segment.StepGroupId === result.FlightSegments[segIndex+1].StepGroupId" class="m-3"></div>-->
                            </div>
                        </div>
                        <div class="col-sm-2 text-right">
                            <div [ngSwitch]="fare.ConnectorCode" class="text-right">
                                <span class="badge badge-pill badge-secondary text-white p-1 m-1">{{fare.Id}}</span>
                                <span *ngSwitchCase="'AMADEUS'" class="badge amadeus-color text-white p-2 m-1">{{fare.ConnectorCode}}</span>
                                <span *ngSwitchCase="'SABRE'" class="badge sabre-color text-white p-2 m-1">{{fare.ConnectorCode}}</span>
                                <span *ngSwitchDefault class="badge bg-info text-white p-2 m-1">{{fare.ConnectorCode}}</span>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="text-right">
                                <div *ngIf="fare.PaxFareList && fare.PaxFareList[0]?.FlightSegmentDetails[0]"><span class="badge badge-pill badge-primary p-1 m-1">{{fare.PaxFareList[0]?.FlightSegmentDetails[0].BrandedFare}}</span></div>
                            </div>
                            <!--              <div [ngSwitch]="fare.ConnectorCode" class="text-right">-->
                            <!--                <span *ngSwitchCase="'AMADEUS'" class="badge amadeus-color text-white p-2 m-1">{{fare.ConnectorCode}}</span>-->
                            <!--                <span *ngSwitchCase="'SABRE'" class="badge sabre-color text-white p-2 m-1">{{fare.ConnectorCode}}</span>-->
                            <!--                <span *ngSwitchDefault class="badge bg-info text-white p-2 m-1">{{fare.ConnectorCode}}</span>-->
                            <!--                <span class="badge badge-pill badge-secondary text-white p-1 m-1">{{fare.Id}}</span>-->
                            <!--              </div>-->

                            <div class="text-right">
                                <!--                <div *ngIf="fare.PaxFareList[0]?.FlightSegmentDetails[0]"><span class="badge badge-pill badge-primary p-1 m-1">{{fare.PaxFareList[0]?.FlightSegmentDetails[0].BrandedFare}}</span></div>-->
                                <div>
                                    <span class="font-weight-bold h5">{{fare.Amount.Amount}}</span>
                                    <span>{{fare.Amount.Currency}}</span>
                                </div>
                                <div *ngIf="fare.FeeList && fare.FeeList.length > 0">
                                    <span class="text-warning font-weight-bold cursor-pointer" [ngbPopover]="feesTemplate" placement="left" container="body" popoverTitle="Fee List" triggers="mouseenter:mouseleave">Included Fees <i class="fas fa-info-circle"></i></span>

                                    <ng-template #feesTemplate>
                                        <div *ngFor="let fee of fare.FeeList">
                                            <div class="font-weight-bold">{{fee.Code}} - {{fee.Name}}</div>
                                            <div>{{fee.Amount}} {{fee.Currency}}</div>
                                            <hr>
                                        </div>
                                    </ng-template>

                                </div>
                            </div>

                            <div class="text-right">
                                <span class="mr-2"><i class="fas fa-bug" (click)="result['_Debug'] = !result['_Debug'];"></i></span>
                                <button class="btn btn-sm btn-primary" (click)="flightDetails(result,fare)"><i class="fas fa-search"></i> Details</button>
                            </div>

                            <!--<div>{{result.ResultKey}}</div>-->
                        </div>
                    </div>
                </div>

                <div *ngIf="result['_Debug']">
                    <nb-card>
                        <nb-card-header>
                            <span class="h4">Result Json</span>
                            <span class="float-right">
                  <button class="btn btn-sm btn-warning" (click)="result['_Debug'] = !result['_Debug'];"><i class="fas fa-times"></i> </button>
              </span>
                        </nb-card-header>
                        <nb-card-body>
                            <ace [mode]="'json'" [theme]="'monokai'" [value]="result | json" style="height: 650px; width:100%; overflow: scroll;"></ace>
                            <!--<pre>{{result | json}}</pre>-->
                        </nb-card-body>
                    </nb-card>
                </div>
            </nb-card-body>
        </nb-card>
    </virtual-scroll>

</div>
<!-- END FLIGHT AVAIL RESPONSE -->